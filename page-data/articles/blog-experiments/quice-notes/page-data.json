{"componentChunkName":"component---src-templates-article-tsx","path":"/articles/blog-experiments/quice-notes/","result":{"pageContext":{"dest_url":"/articles/blog-experiments/quice-notes/","current":{"fields":{"dest_url":"/articles/blog-experiments/quice-notes/"},"excerpt":"Fragment 和 <> 是一个东西","frontmatter":{"title":"Quick Notes","date":"2020-01-02T03:03:27.000Z","keyWords":"Note, React, Bootstrap, Gatsby","series":"Diary"},"html":"<p>Fragment 和 &#x3C;> 是一个东西</p>"},"prev":{"fields":{"dest_url":"/articles/blog-experiments/typed-component-with-default-properties/"},"excerpt":"利用 Typescript 的类型系统，可以写出更好的、tslint 友好的默认参数。 核心代码 这段代码可以通过传入的默认参数，给 component…","frontmatter":{"title":"Gatsby踩坑记 2.给React Component @ Typescript添加默认参数的正确姿势","date":"2019-12-31T21:41:15.000Z","keyWords":"Typescript,Reactjs,Component,默认参数,default Props","series":"Typescript,Reactjs,Gatsby踩坑记"},"html":"<p>利用 Typescript 的类型系统，可以写出更好的、tslint 友好的默认参数。</p>\n<h2>核心代码</h2>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//DefaultPropsUtil.tsx</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> withDefaultProps <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">P</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">object</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DP</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Partial<span class=\"token operator\">&lt;</span><span class=\"token constant\">P</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> Partial<span class=\"token operator\">&lt;</span><span class=\"token constant\">P</span><span class=\"token operator\">>></span><span class=\"token punctuation\">(</span>\n    defaultProps<span class=\"token operator\">:</span> <span class=\"token constant\">DP</span><span class=\"token punctuation\">,</span>\n    Cmp<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ComponentType<span class=\"token operator\">&lt;</span><span class=\"token constant\">P</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">type</span> <span class=\"token class-name\">RequiredProps</span> <span class=\"token operator\">=</span> Omit<span class=\"token operator\">&lt;</span><span class=\"token constant\">P</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">keyof</span> <span class=\"token constant\">DP</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">type</span> <span class=\"token class-name\">Props</span> <span class=\"token operator\">=</span> Partial<span class=\"token operator\">&lt;</span><span class=\"token constant\">DP</span><span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span> RequiredProps<span class=\"token punctuation\">;</span>\n    Cmp<span class=\"token punctuation\">.</span>defaultProps <span class=\"token operator\">=</span> defaultProps<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>Cmp <span class=\"token keyword\">as</span> React<span class=\"token punctuation\">.</span>ComponentType<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> React<span class=\"token punctuation\">.</span>ComponentType<span class=\"token operator\">&lt;</span>Props<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> withDefaultProps<span class=\"token punctuation\">;</span></code></pre></div>\n<p>这段代码可以通过传入的默认参数，给 component 对应的参数位设置为字面值类型。</p>\n<h2>使用方法</h2>\n<ol>\n<li>\n<p>定义<code class=\"language-text\">defaultProps</code>的值:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> defaultProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    hide<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>定义 component 的 props 类型:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">IExample</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    motd<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">&amp;</span> Readonly<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> defaultProps<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>注意这里要用 type 而不是 interface。</p>\n</li>\n<li>\n<p>定义 component，这个不是直接用来导出的。这里用 functional component 作为例子:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">FC</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> TExample<span class=\"token operator\">:</span> <span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>IExample<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>div style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>hide <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> display<span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>motd<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>最后调用 withDefaultProps, 并且 export</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> withDefaultProps <span class=\"token keyword\">from</span> <span class=\"token string\">\"./DefaultPropsUtil\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Example <span class=\"token operator\">=</span> <span class=\"token function\">withDefaultProps</span><span class=\"token punctuation\">(</span>defaultProps<span class=\"token punctuation\">,</span> TExample<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Example<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<h2>更复杂的例子:</h2>\n<p>这个博客的 SEO 部分使用了这个方法:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// SEO.tsx</span>\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">FC</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> withDefaultProps <span class=\"token keyword\">from</span> <span class=\"token string\">\"./DefaultPropsUtil\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">LangSpec</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"zh\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">TypeSpec</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"article\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"website\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">KwdType</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// default props</span>\n<span class=\"token keyword\">const</span> defaultProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    keywords<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span> <span class=\"token keyword\">as</span> KwdType<span class=\"token punctuation\">,</span>\n    lang<span class=\"token operator\">:</span> <span class=\"token string\">\"zh\"</span> <span class=\"token keyword\">as</span> LangSpec<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"article\"</span> <span class=\"token keyword\">as</span> TypeSpec<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">DefaultProps</span> <span class=\"token operator\">=</span> Readonly<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> defaultProps<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ISEOData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    description<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    title<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    location<span class=\"token operator\">:</span> Location<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">&amp;</span> DefaultProps<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SEO_</span><span class=\"token operator\">:</span> <span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>ISEOData<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do whatever you want</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SEO</span> <span class=\"token operator\">=</span> <span class=\"token function\">withDefaultProps</span><span class=\"token punctuation\">(</span>defaultProps<span class=\"token punctuation\">,</span> <span class=\"token constant\">SEO_</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token constant\">SEO</span><span class=\"token punctuation\">;</span></code></pre></div>"},"next":null}},"staticQueryHashes":["4025053006"]}