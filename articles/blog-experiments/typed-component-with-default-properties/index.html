<!DOCTYPE html><html lang="zh"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/styles.8646efe7c1cb1fb34b9e.css"/><meta name="generator" content="Gatsby 2.24.73"/><title data-react-helmet="true">Gatsby踩坑记 2.给React Component @ Typescript添加默认参数的正确姿势 | 白咕咕のエラーはっせい記録</title><link data-react-helmet="true" rel="canonical"/><meta data-react-helmet="true" name="description" content="利用 Typescript 的类型系统，可以写出更好的、tslint 友好的默认参数。 核心代码 这段代码可以通过传入的默认参数，给 component…"/><meta data-react-helmet="true" name="author" content="Somiona"/><meta data-react-helmet="true" name="keywords" content="Typescript,Reactjs,Component,默认参数,default Propsblog,somiona,somion,博客,reactjs,java,diary,日志,日记,python,sass"/><meta data-react-helmet="true" charSet="UTF-8"/><meta data-react-helmet="true" property="og:description" content="利用 Typescript 的类型系统，可以写出更好的、tslint 友好的默认参数。 核心代码 这段代码可以通过传入的默认参数，给 component…"/><meta data-react-helmet="true" property="og:title" content="Gatsby踩坑记 2.给React Component @ Typescript添加默认参数的正确姿势"/><meta data-react-helmet="true" property="og:locale" content="zh"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:site_name" content="白咕咕のエラーはっせい記録"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-cb674ec08534925c798d.js"/><link as="script" rel="preload" href="/framework-81279cacaab4bdba7685.js"/><link as="script" rel="preload" href="/app-c83f7300da342f7e51c8.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cb1608f2-95cace909f6e27480ca5.js"/><link as="script" rel="preload" href="/0555f7d405b1b2da78e3f4257dc3a9bfc65ebedc-a1b210d56afa13395a4a.js"/><link as="script" rel="preload" href="/f3f3717f384d24faba9f6557f586998549cbde31-fc6bc36635ddcc133486.js"/><link as="script" rel="preload" href="/component---src-templates-article-tsx-c22b6811a8db7ab07b54.js"/><link as="fetch" rel="preload" href="/page-data\articles\blog-experiments\typed-component-with-default-properties\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4025053006.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex-column d-flex min-vh-100"><header class="header"><nav class="navbar navbar-expand-md navbar-dark bg-primary fixed-top"><a class="navbar-brand" href="/"><span class="header-title">白咕咕のエラーはっせい記録</span><span class="header-author">Somiona</span></a><button aria-controls="navCollapse" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navCollapse"><div class="mr-auto navbar-nav"><div class="nav-item"><a class="nav-link" href="/">Home</a></div><div class="nav-item"><a href="#" data-rb-event-key="#" class="disabled nav-link" role="button">About</a></div><div class="nav-item"><a href="#" data-rb-event-key="#" class="disabled nav-link" role="button">Tag</a></div></div></div></nav></header><main role="main" class="main flex-shrink-0 flex-grow-1"><div class="container b_b"><h2>Gatsby踩坑记 2.给React Component @ Typescript添加默认参数的正确姿势</h2><div><article><section><p>利用 Typescript 的类型系统，可以写出更好的、tslint 友好的默认参数。</p>
<h2>核心代码</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">//DefaultPropsUtil.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> withDefaultProps <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token punctuation">,</span> <span class="token constant">DP</span> <span class="token keyword">extends</span> <span class="token class-name">Partial<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">></span></span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">>></span><span class="token punctuation">(</span>
    defaultProps<span class="token operator">:</span> <span class="token constant">DP</span><span class="token punctuation">,</span>
    Cmp<span class="token operator">:</span> React<span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">></span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token class-name">RequiredProps</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token keyword">keyof</span> <span class="token constant">DP</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span><span class="token constant">DP</span><span class="token operator">></span> <span class="token operator">&amp;</span> RequiredProps<span class="token punctuation">;</span>
    Cmp<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> defaultProps<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>Cmp <span class="token keyword">as</span> React<span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">as</span> React<span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span>Props<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> withDefaultProps<span class="token punctuation">;</span></code></pre></div>
<p>这段代码可以通过传入的默认参数，给 component 对应的参数位设置为字面值类型。</p>
<h2>使用方法</h2>
<ol>
<li>
<p>定义<code class="language-text">defaultProps</code>的值:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    hide<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p>定义 component 的 props 类型:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">IExample</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    motd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> defaultProps<span class="token operator">></span><span class="token punctuation">;</span></code></pre></div>
<p>注意这里要用 type 而不是 interface。</p>
</li>
<li>
<p>定义 component，这个不是直接用来导出的。这里用 functional component 作为例子:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> TExample<span class="token operator">:</span> <span class="token constant">FC</span><span class="token operator">&lt;</span>IExample<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>hide <span class="token operator">?</span> <span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">"none"</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>motd<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p>最后调用 withDefaultProps, 并且 export</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> withDefaultProps <span class="token keyword">from</span> <span class="token string">"./DefaultPropsUtil"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Example <span class="token operator">=</span> <span class="token function">withDefaultProps</span><span class="token punctuation">(</span>defaultProps<span class="token punctuation">,</span> TExample<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Example<span class="token punctuation">;</span></code></pre></div>
</li>
</ol>
<h2>更复杂的例子:</h2>
<p>这个博客的 SEO 部分使用了这个方法:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// SEO.tsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> withDefaultProps <span class="token keyword">from</span> <span class="token string">"./DefaultPropsUtil"</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LangSpec</span> <span class="token operator">=</span> <span class="token string">"zh"</span> <span class="token operator">|</span> <span class="token string">"en"</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">TypeSpec</span> <span class="token operator">=</span> <span class="token string">"article"</span> <span class="token operator">|</span> <span class="token string">"website"</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">KwdType</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// default props</span>
<span class="token keyword">const</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    keywords<span class="token operator">:</span> <span class="token string">""</span> <span class="token keyword">as</span> KwdType<span class="token punctuation">,</span>
    lang<span class="token operator">:</span> <span class="token string">"zh"</span> <span class="token keyword">as</span> LangSpec<span class="token punctuation">,</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">"article"</span> <span class="token keyword">as</span> TypeSpec<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">DefaultProps</span> <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span><span class="token keyword">typeof</span> defaultProps<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">ISEOData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    description<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    location<span class="token operator">:</span> Location<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> DefaultProps<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">SEO_</span><span class="token operator">:</span> <span class="token constant">FC</span><span class="token operator">&lt;</span>ISEOData<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// do whatever you want</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">SEO</span> <span class="token operator">=</span> <span class="token function">withDefaultProps</span><span class="token punctuation">(</span>defaultProps<span class="token punctuation">,</span> <span class="token constant">SEO_</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">SEO</span><span class="token punctuation">;</span></code></pre></div></section></article></div></div></main><footer class="footer mt-auto py-3"><div class="text-center container"><div>© 2019 - 2020 Somiona </div><div>Powered by<!-- --> <b><a href="https://www.gatsbyjs.org">Gatsby</a></b></div><div><a href="https://www.pixiv.net/artworks/75393550">Main Background Picture<!-- --> </a>BY<a href="https://www.pixiv.net/member.php?id=16600489"> <!-- -->Leiq @ Pixiv</a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  window.excludeGAPaths=[/^(?:\/preview\/(?:(?!(?:\/|^)\.).)*?)$/,/^(?:assets\/)$/,/^(?:images\/)$/];
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-155100629-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-155100629-1', 'blog.somiona.live', {"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      
      
      
      ga('set', 'allowAdFeatures', 'false');
ga('set', 'forceSSL', 'true');

      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/blog-experiments/typed-component-with-default-properties/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1a9fb2898282dc480635.js"],"app":["/app-c83f7300da342f7e51c8.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-241020a1cf7d0f317bbe.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-8fcad0dfd9f1ddee9917.js"],"component---src-pages-articles-tsx":["/component---src-pages-articles-tsx-c4d50180f4873d755b6d.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-4ed79c9e4312b4ed2fb5.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-ec857e00a79fd0d4de73.js"],"component---src-templates-article-tsx":["/component---src-templates-article-tsx-c22b6811a8db7ab07b54.js"]};/*]]>*/</script><script src="/polyfill-1a9fb2898282dc480635.js" nomodule=""></script><script src="/component---src-templates-article-tsx-c22b6811a8db7ab07b54.js" async=""></script><script src="/f3f3717f384d24faba9f6557f586998549cbde31-fc6bc36635ddcc133486.js" async=""></script><script src="/0555f7d405b1b2da78e3f4257dc3a9bfc65ebedc-a1b210d56afa13395a4a.js" async=""></script><script src="/cb1608f2-95cace909f6e27480ca5.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-c83f7300da342f7e51c8.js" async=""></script><script src="/framework-81279cacaab4bdba7685.js" async=""></script><script src="/webpack-runtime-cb674ec08534925c798d.js" async=""></script></body></html>